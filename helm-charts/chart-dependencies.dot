digraph kflix {
  compound=true
  newrank=true;
  node [fontname = "Handlee", style="rounded", shape="rectangle"]
  edge [fontname = "Handlee"]
  
  subgraph cluster_k3s {
    label="k3s"
    helm [shape="square"]
    helm -> argocd
    argocd [label="argocd"]
    argocd -> longhorn [lhead=cluster_config]
    argocd -> jenkins [lhead=cluster_applications]
    
    {rank=source; helm;}
    subgraph cluster_config {
      label="core config"
      longhorn
      es [label="external-secrets"]
      cm [label="cert-manager"]
      rclone
      diun
      edns [label="external-dns"]
      nginx
      suc [label="system upgrade \ncontroller"]
      es -> longhorn, rclone, edns, diun, cm
      cm -> longhorn
    }

    subgraph cluster_applications {
      label="applications"
      jenkins
      nextcloud
      prowlarr
      uk [label="uptime kuma"]

      subgraph cluster_plex {
        label="plex"
        plex
        pw1 [label="plex-worker"]
        pw2 [label="plex-worker"]
        pw3 [label="plex-worker"]
        plex -> pw1,pw2,pw3
      }
      
      {rank=source; uk; jenkins; prowlarr; nextcloud;}
    }

    subgraph cluster_local_volumes {
      label="local volumes"
      downloads
      nzbs
      {rank=same; nzbs; downloads}
    }
    
    subgraph cluster_remote_volumes {
      label="remote volumes"
      movies
      tv
      books
      {rank=same; movies; tv; books;}
    }
    longhorn -> downloads [lhead="cluster_local_volumes"]
    rclone -> movies [lhead="cluster_remote_volumes"]
    // {rank=same; downloads; movies; books; tv; nzbs;}

  }
}